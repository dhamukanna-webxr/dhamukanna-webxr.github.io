<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Manual Hand Grab + Throw</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene
      physics="gravity: -9.8"
      webxr="optionalFeatures: hand-tracking"
      vr-mode-ui="enabled: false"
    >

      <a-entity camera position="0 1.6 0"></a-entity>

      <!-- Light -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 3 2"></a-entity>

      <!-- Ground -->
      <a-plane static-body rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>

      <!-- Grabbable Cube -->
      <a-box id="cube"
             dynamic-body
             color="orange"
             position="0 1.5 -1"
             depth="0.2"
             height="0.2"
             width="0.2"
      ></a-box>

      <!-- Right Hand -->
      <a-entity id="rightHand"
                hand-tracking-controls="hand: right"
                hand-grab-throw></a-entity>

      <script>
        AFRAME.registerComponent('hand-grab-throw', {
          schema: { threshold: { default: 0.02 } }, // pinch distance

          init: function () {
            this.el.isGrabbing = false;
            this.grabbed = null;
          },

          tick: function () {
            const handObj = this.el.object3D;
            const thumbTip = handObj.getObjectByName('thumb-tip');
            const indexTip = handObj.getObjectByName('index-finger-tip');
            const cube = document.querySelector('#cube');

            if (!thumbTip || !indexTip || !cube) return;

            const dist = thumbTip.position.distanceTo(indexTip.position);

            if (dist < this.data.threshold && !this.el.isGrabbing) {
              // Start grab
              const cubeObj = cube.object3D;
              const handWorldPos = new THREE.Vector3();
              this.el.object3D.getWorldPosition(handWorldPos);

              const cubeWorldPos = new THREE.Vector3();
              cubeObj.getWorldPosition(cubeWorldPos);

              const distanceToCube = handWorldPos.distanceTo(cubeWorldPos);
              if (distanceToCube < 0.15) { // hand close to cube
                this.el.isGrabbing = true;
                this.grabbed = cube;

                // Freeze physics & parent to hand
                cube.removeAttribute('dynamic-body');
                handObj.attach(cubeObj);
              }
            }

            // Release on unpinch
            if (dist >= this.data.threshold && this.el.isGrabbing && this.grabbed) {
              this.el.isGrabbing = false;

              // Detach from hand and add physics back
              const cube = this.grabbed;
              this.el.sceneEl.object3D.attach(cube.object3D);
              cube.setAttribute('dynamic-body', '');

              // Add throwing force (optional)
              const handVelocity = this.el.getAttribute('velocity') || {x:0, y:0, z:0};
              cube.body.velocity.set(
                handVelocity.x,
                handVelocity.y,
                handVelocity.z
              );

              this.grabbed = null;
            }
          }
        });
      </script>

    </a-scene>
  </body>
</html>
